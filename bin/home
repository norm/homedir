#!/bin/sh
#
# copy home directory files to the named machine

host="${1}"
just_ssh="${2}"

if [ -n "${host}" ]; then
    
    # base files
    SKELETON="${HOME}/Projects/homedir"
    KEYSFILE="${HOME}/.ssh/authorized_keys"
    
    if [ -z $just_ssh ]; then
        # make sure the skeleton is up-to-date
        cd ${SKELETON} 
        git pull
    fi
    
    # first transfer the keys file
    ssh ${host} "mkdir -p .ssh"
    rsync -v ${KEYSFILE} ${host}:.ssh/authorized_keys
    
    if [ -z $just_ssh ]; then
        # then copy everything else (this has the side effect
        # of illustrating whether ssh now works passwordless)
        rsync -aHvP . ${host}:.
    fi
    
else
    echo "Usage: home <host>"
    exit 1
fi
